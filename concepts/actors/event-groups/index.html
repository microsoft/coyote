<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://microsoft.github.io/coyote/concepts/actors/event-groups/">
    <link rel="shortcut icon" href="/coyote/img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event groups - Coyote</title>
    <link href="/coyote/css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="/coyote/css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="/coyote/css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="/coyote/css/highlight.css">
    <link href="../../../css/main.css" rel="stylesheet">
    <link href="../../../css/player-controls.css" rel="stylesheet">
    <link href="../../../css/syntax.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="/coyote/js/jquery-3.2.1.min.js"></script>
    <script src="/coyote/js/bootstrap-3.3.7.min.js"></script>
    <script src="/coyote/js/highlight.pack.js"></script>
    <script src="https://consentdeliveryfd.azurefd.net/mscc/lib/v2/wcp-consent.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '/coyote/';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Event groups", url: "#_top", children: [
              {title: "EventGroup", url: "#eventgroup" },
              {title: "AwaitableEventGroup\u0026lt;\u0026gt;", url: "#awaitableeventgroup" },
              {title: "Clearing the CurrentEventGroup", url: "#clearing-the-currenteventgroup" },
              {title: "Custom EventGroups", url: "#custom-eventgroups" },
          ]},
        ];

    </script>
    <script src="/coyote/js/base.js"></script>
      <script src="../../../assets/js/analytics.js"></script>
      <script src="../../../assets/js/plugins.js"></script>
      <script src="../../../assets/js/animate_trace.js"></script>
      <script src="../../../assets/js/animation.js"></script>
      <script src="../../../assets/js/progress_bar.js"></script>
      <script src="../../../assets/js/trace_model.js"></script>
      <script src="../../../assets/js/main.js"></script>

</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>

<div id="cookie-banner"></div>


<div class="wrapper wm-page-content">
  <div class="container-fluid">
    <a name="_top"></a>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../uncaught-exceptions/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../uncaught-exceptions/" class="btn btn-xs btn-link">
        Semantics of unhandled exceptions
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../timers/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../timers/" class="btn btn-xs btn-link">
        Using timers in actors
      </a>
    </div>
    
  </div>

      

      <h2 id="event-groups">Event groups</h2>
<p>For some applications, it is useful to know which actor is processing an event derived from some
user request. Coyote offers the notion of an <em>EventGroup</em> that can be tracked automatically. The
following <code>IActorRuntime</code> APIs take an optional <code>EventGroup</code> parameter.</p>
<pre><code class="language-csharp">ActorId CreateActor(Type type, Event e = null, EventGroup group = null);
void SendEvent(ActorId target, Event e, EventGroup group = null);
</code></pre>
<p>When you pass a non-null group the runtime takes care of propagating it to any subsequent actors
that might be created and across any <code>SendEvent</code> calls to any other actors. So all the work
performed as a result of these actors and events can be grouped into a logical group.</p>
<p>The <code>EventGroup</code> argument on <code>SendEvent</code> is optional, the value <code>null</code> means pick up the
<code>CurrentEventGroup</code> of the sender and pass it along to the target actor (if there is one).</p>
<p>The <code>Actor</code> class has a field that returns the current <code>EventGroup</code>. The <code>EventGroup</code> is stored
with the event and <code>CurrentEventGroup</code> is set when the event is dequeued.</p>
<pre><code class="language-csharp">EventGroup CurrentEventGroup { get; set; }
</code></pre>
<p>Additionally you may use the following <code>IActorRuntime</code> API to get the current group of any actor.</p>
<pre><code class="language-csharp">EventGroup GetCurrentEventGroup(ActorId actorId);
</code></pre>
<p>The <code>CurrentEventGroup</code> is automatically passed along whenever you use <code>CreateActor</code> or <code>SendEvent</code>
as shown below:</p>
<p><img alt="EventGroups" src="../../../assets/images/EventGroups.svg" /></p>
<h3 id="eventgroup">EventGroup</h3>
<p>The base <code>EventGroup</code> class contains the following:</p>
<pre><code class="language-csharp">public Guid Id { get; internal set; }
public string Name { get; internal set; }
</code></pre>
<p>The <code>Guid</code> is automatically assigned to <code>Guid.Empty</code>. The <code>Name</code> defaults to null but you can
provide any friendly name you want there.</p>
<h3 id="awaitableeventgroup">AwaitableEventGroup&lt;<T>&gt;</h3>
<p>As a convenience the following typed EventGroup is also provided that can also be used to wait for
some result to be returned from the actors that share this group:</p>
<pre><code class="language-csharp">public class AwaitableEventGroup&lt;T&gt; : EventGroup
{
    public bool IsCompleted { get; }
    public Task&lt;T&gt; Task { get; }
    public virtual void SetResult(T result);
    public TaskAwaiter&lt;T&gt; GetAwaiter();
}
</code></pre>
<p>You can pass this group to your actors so that one of those actors can decide at some point to call
<code>SetResult</code>. Then you can <code>await</code> on this object for the result. In this way you can asynchronously
return a result from a collection of actors that are performing some job. <code>SetResult</code> also sets
<code>IsCompleted</code> to true.</p>
<h3 id="clearing-the-currenteventgroup">Clearing the CurrentEventGroup</h3>
<p>You might need to clear the current event group at some point in your <code>Actor</code>. To do this you can
simply set the property to null:</p>
<pre><code class="language-csharp">this.CurrentEventGroup = null;
</code></pre>
<p>However, this could be overridden by any subsequent event that is dequeued from the event queue. If
you do not want the <code>CurrentEventGroup</code> to be passed along to the target actor you can pass a
special <code>EventGroup.Null</code> event group like this:</p>
<pre><code class="language-csharp">this.SendEvent(target, e, EventGroup.Null);
</code></pre>
<p>This will put a <code>null</code> in the event queue of the target actor so that when this event is dequeued
the <code>CurrentEventGroup</code> of the target actor will be set to <code>null</code>.  In this way then you can propagate
a null <code>EventGroup</code> to all your actors.</p>
<h3 id="custom-eventgroups">Custom EventGroups</h3>
<p>The <code>EventGroup</code> class is unsealed so you can create any custom class that you need. The following
is an example that counts a certain number of steps before completing the boolean
<code>AwaitableEventGroup</code>:</p>
<pre><code class="language-csharp">public class EventGroupCounter : AwaitableEventGroup&lt;bool&gt;
{
    public int ExpectedCount;

    public EventGroupCounter(int expected)
    {
        this.ExpectedCount = expected;
    }

    public void Complete()
    {
        var count = Interlocked.Decrement(ref this.ExpectedCount);
        if (count == 0)
        {
            this.SetResult(true);
        }
    }
}
</code></pre>
<p>This way you can have multiple actors calling <code>Complete</code> and the outer code that is waiting is not
released until the expected count is reached.</p>
<p>Similarly you can create an <code>EventGroup</code> that gathers multiple results from various actors like this:</p>
<pre><code class="language-csharp">public class EventGroupList : AwaitableEventGroup&lt;List&lt;string&gt;&gt;
{
    public List&lt;string&gt; Items = new List&lt;string&gt;();

    public void AddItem(string msg)
    {
        this.Items.Add(msg);
    }

    public void Complete()
    {
        this.SetResult(Items);
    }
}
</code></pre>
<p>Then when the final actor calls <code>Complete()</code> the list of gathered items is then made available to the
waiting caller via <code>SetResult</code>.</p>

    <br>
      

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../uncaught-exceptions/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../uncaught-exceptions/" class="btn btn-xs btn-link">
        Semantics of unhandled exceptions
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../timers/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../timers/" class="btn btn-xs btn-link">
        Using timers in actors
      </a>
    </div>
    
  </div>

      <br>
  </div>
</div>

<footer class="wm-page-content">
  

<section class="footer-join pt-40 pb-80">
  <div class="container-fluid">
    <div class="row text-center">
      <div class="col-sm-8 col-sm-offset-2">
      </div>
    </div>
    <div class="row">
   </div>
  </div>
</section>
<section class="footer-dark pt-60">
  <div class="container-fluid">
    <div class="row">
      <div class="hidden-xs col-sm-5 col-lg-6">
        <a href="" title="homepage" class="logo-footer">
          <img src="/coyote/assets/images/icon.png" alt="Coyote">
        </a>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Coyote</h4>
          <ul class="list-unstyled">
            <li><a href="/coyote/">Home</a></li>
            <li><a href="/coyote/get-started/install/">Install</a></li>
            <li><a href="https://github.com/microsoft/coyote/"><i class="fa fa-github"></i>
GitHub</a></li>
          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Resources</h4>
          <ul class="list-unstyled">
            <li><a href="/coyote/tutorials/first-concurrency-unit-test/">Getting started</a></li>
            <li><a href="/coyote/tutorials/overview/">Tutorials</a></li>
            <li><a href="/coyote/ref/Microsoft.Coyote">API documentation</a></li>
          </ul>
        </nav>
      </div>

      <div class="col-sm-2 col-xs-4 footer-dark-col">
        <nav>
          <h4>Community</h4>
          <ul class="list-unstyled">
            <li><a href="https://github.com/microsoft/coyote/discussions"><i class="fa fa-github"></i>
GitHub</a></li>
            <li><a href="https://twitter.com/coyote_dev" target="_blank"><i class="fa fa-twitter"></i> Twitter</a></li>
            <li><a href="https://teams.microsoft.com/l/channel/19%3a1fe966b4fdc544bca648d89bf25c3c56%40thread.tacv2/General?groupId=7a6d8afc-c23d-4e5d-b9cb-9124118c0220&tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47" target="_blank">Teams (Internal)</a></li>
          </ul>
        </nav>
      </div>
    </div>

    <div class="row footnote pt-50 pb-20">
      <div class="col-sm-12">
        <hr>
      </div>
      <div class="col-sm-7">
        <ul class="list-unstyled list-inline footnote-copy">
          <li><a href="https://go.microsoft.com/fwlink/?LinkId=521839" target="_blank">Privacy & Cookies</a></li>
          <li><a href="https://go.microsoft.com/fwlink/?linkid=2259814" target="_blank">Consumer Health Privacy</a></li>
          <li><a href="https://go.microsoft.com/fwlink/?LinkID=206977" target="_blank">Terms of Use</a></li>
          <li><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks" target="_blank">Trademarks</a></li>
          <li><a href="https://github.com/microsoft/coyote/blob/main/LICENSE" target="_blank">License</a></li>
        </ul>
      </div>
      <div class="col-sm-5 text-right footnote-copy">
        <ul class="list-unstyled list-inline">
          <li><span id="copyright"></span></li>
          <li><a href="https://www.microsoft.com/" target="_blank"><img class="img-responsive" src="/coyote/assets/images/microsoft-logo.svg?v=3" alt="Microsoft">&nbsp;</a></li>
        </ul>
      </div>
    </div>
  </div>
</section>
</footer>


<script type="text/javascript">
    $(document).ready(function () {
      $('table').each(function () {
        $(this).addClass("table");
        $(this).addClass("table-bordered");
        $(this).addClass("table-striped");
        $(this).addClass("table-condensed");
      });

    });
</script>

</body>
</html>